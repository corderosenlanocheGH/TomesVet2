<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Historia clínica #<%= historia.id %> | TomesVet</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
      body {
        padding: 1.5rem;
      }

      .header {
        border-bottom: 1px solid #dee2e6;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
      }

      @media print {
        .no-print {
          display: none !important;
        }

        body {
          padding: 0;
        }
      }
    </style>
  </head>
  <body>
    <%
      const formatShortDate = (value = '') => {
        if (!value) return '-';
        const normalized = value.toString().split('T')[0];
        const [year, month, day] = normalized.split('-');
        if (year && month && day) {
          return `${day}/${month}/${year}`;
        }
        const parsed = new Date(value);
        if (!Number.isNaN(parsed.getTime())) {
          return parsed.toLocaleDateString('es-AR');
        }
        return value;
      };

      const showValue = (value) => value || '-';
    %>

    <div class="d-flex justify-content-between align-items-start header">
      <div>
        <h3 class="mb-1">Historia clínica</h3>
        <p class="text-muted mb-0">TomesVet</p>
      </div>
      <div class="text-end">
        <p class="mb-0"><strong>N°:</strong> <%= historia.id %></p>
        <p class="mb-0"><strong>Fecha:</strong> <%= formatShortDate(historia.fecha) %></p>
      </div>
    </div>

    <div class="mb-3 no-print">
      <button class="btn btn-primary" onclick="window.print()">Imprimir / Guardar como PDF</button>
    </div>

    <table class="table table-bordered align-middle mb-0">
      <tbody>
        <tr><th style="width: 30%">Mascota</th><td><%= historia.mascota_nombre %></td></tr>
        <tr><th>Especie</th><td><%= showValue(historia.mascota_especie) %></td></tr>
        <tr><th>Raza</th><td><%= showValue(historia.mascota_raza) %></td></tr>
        <tr><th>Sexo</th><td><%= showValue(historia.mascota_sexo) %></td></tr>
        <tr><th>Tamaño</th><td><%= showValue(historia.mascota_tamanio) %></td></tr>
        <tr><th>Fecha</th><td><%= formatShortDate(historia.fecha) %></td></tr>
        <tr><th>Motivo</th><td><%= showValue(historia.motivo) %></td></tr>
        <tr><th>Aspecto general</th><td><%= showValue(historia.aspecto_general) %></td></tr>
        <tr><th>Estado de nutrición</th><td><%= showValue(historia.estado_nutricion) %></td></tr>
        <tr><th>Última desparacitación</th><td><%= formatShortDate(historia.ultima_desparacitacion) %></td></tr>
        <tr>
          <th>Parámetros</th>
          <td>
            FC: <%= showValue(historia.frecuencia_cardiaca) %><br />
            FR: <%= showValue(historia.frecuencia_respiratoria) %><br />
            Hidratación: <%= showValue(historia.hidratacion) %><br />
            Temperatura: <%= showValue(historia.temperatura) %>
          </td>
        </tr>
        <tr>
          <th>Estado de mucosa</th>
          <td>
            Palpebral: <%= showValue(historia.mucosa_palpebral) %><br />
            Escleral: <%= showValue(historia.mucosa_escleral) %><br />
            Bucal: <%= showValue(historia.mucosa_bucal) %><br />
            Vul/Pen: <%= showValue(historia.mucosa_vulpen) %>
          </td>
        </tr>
        <tr><th>Diagnóstico presuntivo</th><td><%= showValue(historia.diagnostico_presuntivo) %></td></tr>
        <tr><th>Diagnóstico diferencial</th><td><%= showValue(historia.diagnostico_diferencial) %></td></tr>
        <tr><th>Diagnóstico definitivo</th><td><%= showValue(historia.diagnostico_definitivo) %></td></tr>
        <tr><th>Análisis solicitados</th><td><%= showValue(historia.analisis_solicitados) %></td></tr>
        <tr><th>Tratamiento y medicación</th><td><%= showValue(historia.tratamiento) %></td></tr>
      </tbody>
    </table>
  </body>
</html>
